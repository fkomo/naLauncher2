<Window x:Class="naLauncher2.Wpf.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:naLauncher2.Wpf"
    mc:Ignorable="d"
    Title="MainWindow"
    WindowStyle="None"
    WindowState="Maximized"
    AllowsTransparency="True"
    Background="#00202020"
    KeyDown="Window_KeyDown"
    PreviewTextInput="Window_PreviewTextInput"
    Loaded="Window_Loaded">
    <Window.Resources>
        <Style x:Key="DropdownItemStyle" TargetType="TextBlock">
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3A3F42"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid x:Name="RootGrid" Background="#F0181D1F" MouseRightButtonUp="RootGrid_MouseRightButtonUp" MouseLeftButtonUp="RootGrid_MouseLeftButtonUp">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- New Games (horizontal strip) -->
        <StackPanel x:Name="NewGamesSection" Grid.Row="0" Orientation="Vertical" Visibility="Collapsed">
            <Grid Margin="32,32,32,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="New" x:Name="NewGamesLabel" Foreground="White" Opacity="1"
                           FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"
                           Cursor="Hand" MouseLeftButtonUp="NewGamesLabel_Click"/>
                <TextBlock Grid.Column="1" Text="" x:Name="NewGamesCount" Foreground="White" Opacity="1"
                           FontSize="16" FontWeight="Normal"
                           VerticalAlignment="Center" Margin="8,0,16,0"/>
                <Rectangle Grid.Column="2" x:Name="NewGamesScrollTrack" Height="0" Fill="White" Opacity="0.2" VerticalAlignment="Center" Margin="0,3,0,0"/>
                <Rectangle Grid.Column="2" x:Name="NewGamesScrollThumb" Height="3" Fill="LightSkyBlue" Opacity="0" VerticalAlignment="Center" Margin="0,3,0,0" HorizontalAlignment="Left" Width="0">
                    <Rectangle.Effect>
                        <DropShadowEffect Color="LightSkyBlue" ShadowDepth="0" BlurRadius="6" Opacity="0.8"/>
                    </Rectangle.Effect>
                </Rectangle>
            </Grid>
            <Canvas x:Name="NewGamesCanvas" Height="300" ClipToBounds="True" Margin="0,0,0,0" MouseWheel="HorizontalCanvas_MouseWheel">
                <Canvas x:Name="NewGamesContainer"/>
            </Canvas>
        </StackPanel>

        <!-- Recent Games (horizontal strip) -->
        <StackPanel x:Name="RecentGamesSection" Grid.Row="1" Orientation="Vertical" Visibility="Collapsed">
            <Grid x:Name="RecentGamesHeaderGrid" Margin="32,16,32,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Recent" x:Name="RecentGamesLabel" Foreground="White" Opacity="1"
                           FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"
                           Cursor="Hand" MouseLeftButtonUp="RecentGamesLabel_Click"/>
                <TextBlock Grid.Column="1" Text="" x:Name="RecentGamesCount" Foreground="White" Opacity="1"
                           FontSize="16" FontWeight="Normal"
                           VerticalAlignment="Center" Margin="8,0,16,0"/>
                <Rectangle Grid.Column="2" x:Name="RecentGamesScrollTrack" Height="0" Fill="White" Opacity="0.2" VerticalAlignment="Center" Margin="0,3,0,0"/>
                <Rectangle Grid.Column="2" x:Name="RecentGamesScrollThumb" Height="3" Fill="LightSkyBlue" Opacity="0" VerticalAlignment="Center" Margin="0,3,0,0" HorizontalAlignment="Left" Width="0">
                    <Rectangle.Effect>
                        <DropShadowEffect Color="LightSkyBlue" ShadowDepth="0" BlurRadius="6" Opacity="0.8"/>
                    </Rectangle.Effect>
                </Rectangle>
            </Grid>
            <Canvas x:Name="RecentGamesCanvas" Height="300" ClipToBounds="True" Margin="0,0,0,0" MouseWheel="HorizontalCanvas_MouseWheel">
                <Canvas x:Name="RecentGamesContainer"/>
            </Canvas>
        </StackPanel>

        <!-- User Games (vertical multi-row grid) -->
        <Grid x:Name="UserGamesSection" Grid.Row="2" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition x:Name="UserGamesCanvasRow" Height="*"/>
            </Grid.RowDefinitions>
            <Grid x:Name="UserGamesHeaderGrid" Grid.Row="0" Margin="32,16,32,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="1" Text="Installed" x:Name="UserGamesLabel" Foreground="White" Opacity="1"
                           FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"
                           Cursor="Hand" MouseLeftButtonUp="UserGamesLabel_Click"/>
                <TextBlock Grid.Column="2" Text="" x:Name="UserGamesCount" Foreground="White" Opacity="1"
                           FontSize="16" FontWeight="Normal"
                           VerticalAlignment="Center" Margin="8,0,8,0"/>
                <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,8,0">
                    <TextBlock x:Name="UserGamesOrderDirectionToggle" Text="▲" Foreground="White" Opacity="0.5"
                               FontSize="16" Cursor="Hand" VerticalAlignment="Center" Margin="0,0,8,0"
                               MouseLeftButtonUp="UserGamesOrderDirectionToggle_Click"/>
                    <TextBlock x:Name="UserGamesOrderLabel" Text="Title" Foreground="White" Opacity="1"
                               FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"
                               Cursor="Hand" MouseLeftButtonUp="UserGamesOrderLabel_Click"/>
                </StackPanel>
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="CollapsedNewLabel" Text="New"
                               Foreground="#888888" FontSize="16" FontWeight="SemiBold"
                               VerticalAlignment="Center" Cursor="Hand"
                               Visibility="Collapsed" Margin="0,0,8,0"
                               MouseLeftButtonUp="CollapsedNewLabel_Click"/>
                    <TextBlock x:Name="CollapsedRecentLabel" Text="Recent"
                               Foreground="#888888" FontSize="16" FontWeight="SemiBold"
                               VerticalAlignment="Center" Cursor="Hand"
                               Visibility="Collapsed" Margin="0,0,8,0"
                               MouseLeftButtonUp="CollapsedRecentLabel_Click"/>
                </StackPanel>
                <Grid Grid.Column="4" VerticalAlignment="Center" Margin="8,0,8,0">
                    <TextBox x:Name="UserGamesTitleFilter"
                             Background="Transparent"
                             Foreground="White"
                             CaretBrush="White"
                             SelectionBrush="LightSkyBlue"
                             BorderThickness="0"
                             FontSize="16"
                             Padding="4,0,2,0"
                             MinWidth="200"
                             Visibility="Collapsed"
                             TextChanged="UserGamesTitleFilter_TextChanged"/>
                    <Rectangle Height="1" Fill="#44FFFFFF" VerticalAlignment="Bottom"
                               Visibility="{Binding Visibility, ElementName=UserGamesTitleFilter}"/>
                </Grid>
                <Rectangle Grid.Column="5" x:Name="UserGamesScrollTrack" Height="0" Fill="White" Opacity="0.2" VerticalAlignment="Center" Margin="0,3,0,0"/>
                <Rectangle Grid.Column="5" x:Name="UserGamesScrollThumb" Height="3" Fill="LightSkyBlue" Opacity="0" VerticalAlignment="Center" Margin="0,3,0,0" HorizontalAlignment="Left" Width="0">
                    <Rectangle.Effect>
                        <DropShadowEffect Color="LightSkyBlue" ShadowDepth="0" BlurRadius="6" Opacity="0.8"/>
                    </Rectangle.Effect>
                </Rectangle>
            </Grid>
            <Canvas Grid.Row="1" x:Name="UserGamesCanvas" ClipToBounds="True" Margin="0,0,0,0" MouseWheel="VerticalCanvas_MouseWheel">
                <Canvas x:Name="UserGamesContainer"/>
            </Canvas>
        </Grid>

        <!-- Settings button -->
        <TextBlock x:Name="SettingsButton" Grid.RowSpan="3"
                   Text="&#xE713;" FontSize="20" FontFamily="Segoe MDL2 Assets"
                   HorizontalAlignment="Right" VerticalAlignment="Top"
                   Margin="0,16,16,0" Panel.ZIndex="50"
                   Cursor="Hand"
                   MouseLeftButtonUp="SettingsButton_Click">
            <TextBlock.Style>
                <Style TargetType="TextBlock">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Opacity" Value="0.5"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Opacity" Value="1"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </TextBlock.Style>
        </TextBlock>

        <!-- Dropdown overlay: spans all rows, always in the visual tree, no HWND overhead -->
        <Canvas x:Name="DropdownOverlay" Grid.RowSpan="3"
                Panel.ZIndex="100" Background="Transparent"
                Visibility="Collapsed"
                MouseLeftButtonUp="DropdownOverlay_Click"
                MouseRightButtonUp="DropdownOverlay_RightClick">
            <Border x:Name="UserGamesFilterPanel" Background="#FF282C2E" BorderBrush="#FF404448" BorderThickness="1" MinWidth="160" Visibility="Collapsed">
                <StackPanel>
                    <TextBlock x:Name="FilterOptionInstalled" Style="{StaticResource DropdownItemStyle}" Text="Installed" Tag="Installed" MouseLeftButtonUp="UserGamesFilter_Click"/>
                    <TextBlock x:Name="FilterOptionRemoved" Style="{StaticResource DropdownItemStyle}" Text="Removed" Tag="Removed" MouseLeftButtonUp="UserGamesFilter_Click"/>
                    <TextBlock x:Name="FilterOptionCompleted" Style="{StaticResource DropdownItemStyle}" Text="Completed" Tag="Completed" MouseLeftButtonUp="UserGamesFilter_Click"/>
                    <TextBlock x:Name="FilterOptionAll" Style="{StaticResource DropdownItemStyle}" Text="All" Tag="All" MouseLeftButtonUp="UserGamesFilter_Click"/>
                </StackPanel>
            </Border>
            <Border x:Name="UserGamesOrderPanel" Background="#FF282C2E" BorderBrush="#FF404448" BorderThickness="1" MinWidth="160" Visibility="Collapsed">
                <StackPanel>
                    <TextBlock x:Name="SortOptionTitle" Style="{StaticResource DropdownItemStyle}" Text="Title" Tag="Title" MouseLeftButtonUp="UserGamesOrder_Click"/>
                    <TextBlock x:Name="SortOptionAdded" Style="{StaticResource DropdownItemStyle}" Text="Added" Tag="Added" MouseLeftButtonUp="UserGamesOrder_Click"/>
                    <TextBlock x:Name="SortOptionCompleted" Style="{StaticResource DropdownItemStyle}" Text="Completed" Tag="Completed" MouseLeftButtonUp="UserGamesOrder_Click"/>
                    <TextBlock x:Name="SortOptionPlayed" Style="{StaticResource DropdownItemStyle}" Text="Played" Tag="Played" MouseLeftButtonUp="UserGamesOrder_Click"/>
                    <TextBlock x:Name="SortOptionRating" Style="{StaticResource DropdownItemStyle}" Text="Rating" Tag="Rating" MouseLeftButtonUp="UserGamesOrder_Click"/>
                </StackPanel>
            </Border>
            <Border x:Name="GameContextMenuPanel" Background="#FF282C2E" BorderBrush="#FF404448" BorderThickness="1" MinWidth="160" Visibility="Collapsed">
                <StackPanel>
                    <TextBlock x:Name="ContextMenuRun" Style="{StaticResource DropdownItemStyle}" Text="Run" MouseLeftButtonUp="GameContextMenu_Run_Click"/>
                    <TextBlock x:Name="ContextMenuUninstall" Style="{StaticResource DropdownItemStyle}" Text="Uninstall" MouseLeftButtonUp="GameContextMenu_Uninstall_Click"/>
                    <Rectangle Height="1" Fill="#FF404448" Margin="0,4,0,4"/>
                    <TextBlock x:Name="ContextMenuDelete" Style="{StaticResource DropdownItemStyle}" Text="Delete" MouseLeftButtonUp="GameContextMenu_Delete_Click"/>
                    <TextBlock x:Name="ContextMenuMarkAsCompleted" Style="{StaticResource DropdownItemStyle}" Text="Mark as Completed" MouseLeftButtonUp="GameContextMenu_MarkAsCompleted_Click"/>
                    <TextBlock x:Name="ContextMenuRename" Style="{StaticResource DropdownItemStyle}" Text="Rename" MouseLeftButtonUp="GameContextMenu_Rename_Click"/>
                </StackPanel>
            </Border>
        </Canvas>

    </Grid>
</Window>

